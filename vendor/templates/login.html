{% extends "base.html" %}
{% block title %}Login - VendorIQ{% endblock %}

{% block extra_css %}
<style>
/* Full-height auth screen that fits the viewport and stays mobile-friendly */
.auth-shell {
    min-height: calc(100vh - 90px);
    padding: 28px 16px 48px;
    display: grid;
    place-items: center;
}
.auth-layout {
    width: min(1040px, 100%);
    display: grid;
    grid-template-columns: 1.15fr 1fr;
    gap: 24px;
    align-items: stretch;
}
.auth-hero {
    border-radius: 24px;
    padding: 34px 32px;
    background: radial-gradient(1200px 500px at 20% 0%, rgba(37,99,235,0.25), transparent 55%),
                linear-gradient(135deg, #eff6ff 0%, #e0f2fe 50%, #f8fafc 100%);
    border: 1px solid rgba(226,232,240,0.9);
    box-shadow: 0 10px 40px rgba(2,132,199,0.10);
}
.auth-hero h1 {
    font-size: 34px;
    font-weight: 800;
    color: #0f172a;
    letter-spacing: -0.02em;
    margin-bottom: 10px;
}
.auth-hero p {
    color: #475569;
    font-size: 15px;
    line-height: 1.6;
    margin-bottom: 20px;
}
.auth-hero ul {
    margin: 0;
    padding-left: 18px;
    color: #334155;
    font-weight: 600;
    font-size: 14px;
}
.auth-hero li { margin: 10px 0; }

.auth-card {
    background: white;
    border-radius: 24px;
    padding: 34px 32px;
    box-shadow: 0 8px 40px rgba(0,0,0,0.08);
    border: 1px solid rgba(226,232,240,0.8);
}
.auth-card h2 {
    font-size: 24px;
    font-weight: 800;
    color: #0f172a;
    margin-bottom: 6px;
}
.auth-card .subtitle {
    color: #64748b;
    font-size: 15px;
    margin-bottom: 22px;
}

.form-row { margin-bottom: 14px; }
.auth-card label {
    display: block;
    font-weight: 700;
    color: #334155;
    margin-bottom: 8px;
    font-size: 14px;
}
.auth-card input[type="text"],
.auth-card input[type="password"] {
    width: 100%;
    padding: 12px 14px;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    font-size: 15px;
    transition: border-color 0.2s, box-shadow 0.2s;
}
.auth-card input:focus {
    outline: none;
    border-color: #2563eb;
    box-shadow: 0 0 0 4px rgba(37,99,235,0.12);
}
.field-hint {
    margin-top: 8px;
    color: #64748b;
    font-size: 12.5px;
}
.field-error {
    margin-top: 8px;
    color: #dc2626;
    font-size: 13px;
    font-weight: 600;
}
.error-banner {
    margin: 10px 0 16px;
    padding: 12px 14px;
    border-radius: 14px;
    background: rgba(220,38,38,0.08);
    border: 1px solid rgba(220,38,38,0.20);
    color: #b91c1c;
    font-weight: 700;
    font-size: 13px;
}
.pw-row {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 10px;
    align-items: end;
}
.pw-toggle {
    height: 44px;
    padding: 0 14px;
    border-radius: 12px;
    border: 2px solid #e2e8f0;
    background: #f8fafc;
    color: #334155;
    font-weight: 700;
    font-size: 13px;
    cursor: pointer;
}
.pw-toggle:hover { background: #f1f5f9; }

.btn-submit {
    width: 100%;
    padding: 14px;
    background: linear-gradient(90deg, #2563eb, #1d4ed8);
    color: white;
    font-weight: 800;
    font-size: 15px;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    margin-top: 8px;
    transition: opacity 0.2s, transform 0.05s;
}
.btn-submit:hover { opacity: 0.95; }
.btn-submit:active { transform: translateY(1px); }
.btn-submit:disabled { opacity: 0.65; cursor: not-allowed; }

.signup-link {
    margin-top: 18px;
    text-align: center;
    color: #64748b;
    font-size: 14.5px;
}
.signup-link a {
    color: #2563eb;
    font-weight: 800;
    text-decoration: none;
}
.signup-link a:hover { text-decoration: underline; }

@media (max-width: 980px) {
    .auth-layout { grid-template-columns: 1fr; }
    .auth-hero { display: none; }
    .auth-shell { min-height: calc(100vh - 80px); }
    .auth-card { padding: 30px 22px; }
}
</style>
{% endblock %}

{% block content %}

<div class="auth-shell">
    <div class="auth-layout">
        <section class="auth-hero" aria-hidden="true">
            <h1>Welcome back.</h1>
            <p>
                Log in to access your vendor dashboard, vendor rankings, and performance insights â€” all in one place.
            </p>
            <ul>
                <li>Track vendor performance scores</li>
                <li>Compare delivery & quality ratings</li>
                <li>Manage vendors with a clean workflow</li>
            </ul>
        </section>

        <section class="auth-card">
            <h2>Login to VendorIQ</h2>
            <p class="subtitle">Enter your name and password to continue</p>

            {% if form.non_field_errors %}
            <div class="error-banner" role="alert">
                {{ form.non_field_errors.0 }}
            </div>
            {% endif %}

            <form id="loginForm" method="post" action="{% url 'login' %}" novalidate>
                {% csrf_token %}

                <div class="form-row">
                    <label for="id_username">Name</label>
                    <input
                        type="text"
                        name="username"
                        id="id_username"
                        autocomplete="username"
                        required
                        minlength="3"
                        maxlength="150"
                        placeholder="Enter your name"
                        value="{% if form.username.value %}{{ form.username.value }}{% endif %}"
                    >
                    <div class="field-hint">At least 3 characters.</div>
                    {% if form.username.errors %}
                    <div class="field-error" id="nameServerError">{{ form.username.errors.0 }}</div>
                    {% endif %}
                    <div class="field-error" id="nameError" style="display:none;"></div>
                </div>

                <div class="form-row">
                    <label for="id_password">Password</label>
                    <div class="pw-row">
                        <input
                            type="password"
                            name="password"
                            id="id_password"
                            autocomplete="current-password"
                            required
                            minlength="6"
                            placeholder="Enter your password"
                        >
                        <button class="pw-toggle" type="button" id="togglePassword">Show</button>
                    </div>
                    <div class="field-hint">At least 6 characters.</div>
                    {% if form.password.errors %}
                    <div class="field-error" id="pwServerError">{{ form.password.errors.0 }}</div>
                    {% endif %}
                    <div class="field-error" id="pwError" style="display:none;"></div>
                </div>

                <input type="hidden" name="next" value="{{ next|default:'/dashboard/' }}">

                <button type="submit" class="btn-submit" id="submitBtn">Login</button>
            </form>

            <p class="signup-link">
                Don't have an account? <a href="{% url 'signup' %}">Sign up</a>
            </p>
        </section>
    </div>
</div>

<script>
(() => {
  const form = document.getElementById('loginForm');
  const name = document.getElementById('id_username');
  const pw = document.getElementById('id_password');
  const nameError = document.getElementById('nameError');
  const pwError = document.getElementById('pwError');
  const submitBtn = document.getElementById('submitBtn');
  const toggle = document.getElementById('togglePassword');

  const show = (el, msg) => {
    el.textContent = msg;
    el.style.display = msg ? 'block' : 'none';
  };

  const validate = () => {
    let ok = true;

    const n = (name.value || '').trim();
    const p = pw.value || '';

    if (n.length < 3) {
      show(nameError, 'Name must be at least 3 characters.');
      ok = false;
    } else {
      show(nameError, '');
    }

    if (p.length < 6) {
      show(pwError, 'Password must be at least 6 characters.');
      ok = false;
    } else if (p.trim() !== p) {
      show(pwError, 'Password cannot start or end with spaces.');
      ok = false;
    } else {
      show(pwError, '');
    }

    submitBtn.disabled = !ok;
    return ok;
  };

  toggle?.addEventListener('click', () => {
    const isPw = pw.type === 'password';
    pw.type = isPw ? 'text' : 'password';
    toggle.textContent = isPw ? 'Hide' : 'Show';
    pw.focus();
  });

  name.addEventListener('input', validate);
  pw.addEventListener('input', validate);

  form.addEventListener('submit', (e) => {
    if (!validate()) e.preventDefault();
  });

  // Initial state (so the button doesn't submit empty forms)
  validate();
})();
</script>

{% endblock %}
